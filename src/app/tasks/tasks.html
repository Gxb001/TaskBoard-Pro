<div class="tasks-page">
  <!-- Conteneur pour les composants dynamiques (ViewContainerRef) -->
  <ng-container #dynamicComponentContainer></ng-container>

  <header class="page-header">
    <h1>{{ title }}</h1>
    <p class="subtitle">Gérez toutes vos tâches en un seul endroit</p>
  </header>

  <!-- Statistiques -->
  <div class="stats-bar">
    <div class="stat-card total">
      <span class="stat-icon"><i class="bi bi-collection"></i></span>
      <div class="stat-info">
        <span class="stat-value">{{ totalTasks$ | async }}</span>
        <span class="stat-label">Total</span>
      </div>
    </div>
    <div class="stat-card completed">
      <span class="stat-icon"><i class="bi bi-check-circle"></i></span>
      <div class="stat-info">
        <span class="stat-value">{{ completedCount$ | async }}</span>
        <span class="stat-label">Terminées</span>
      </div>
    </div>
    <div class="stat-card pending">
      <span class="stat-icon"><i class="bi bi-hourglass-split"></i></span>
      <div class="stat-info">
        <span class="stat-value">{{ pendingCount$ | async }}</span>
        <span class="stat-label">En cours</span>
      </div>
    </div>
    <div class="stat-card progress">
      <span class="stat-icon"><i class="bi bi-graph-up"></i></span>
      <div class="stat-info">
        <span class="stat-value">{{ progressPercentage$ | async }}%</span>
        <span class="stat-label">Progression</span>
      </div>
    </div>
  </div>

  <!-- Barre de progression -->
  <div class="progress-bar-container">
    <div [style.width.%]="progressPercentage$ | async" class="progress-bar"></div>
  </div>

  <!-- Gestion des données -->
  <section class="data-management-section">
    <h2><i class="bi bi-database"></i> Gestion des données</h2>
    <div class="data-actions">
      <button (click)="resetTasks()" class="btn-reset" title="Réinitialiser aux valeurs par défaut">
        <i class="bi bi-arrow-counterclockwise"></i> Réinitialiser
      </button>
      <button (click)="exportTasks()" class="btn-export" title="Exporter les tâches en JSON">
        <i class="bi bi-download"></i> Exporter JSON
      </button>
      <label class="btn-import" title="Importer des tâches depuis un fichier JSON">
        <i class="bi bi-upload"></i> Importer JSON
        <input #fileInput (change)="importTasks($event)" accept=".json" hidden type="file">
      </label>
    </div>
  </section>

  <!-- Formulaire d'ajout -->
  <section class="add-task-section">
    <h2><i class="bi bi-plus-circle"></i> Nouvelle tâche</h2>
    <form
      (submit)="$event.preventDefault(); addTask(taskTitle.value, taskDesc.value, taskPriority.value); taskTitle.value=''; taskDesc.value=''"
      class="add-task-form">
      <div class="form-row">
        <input #taskTitle class="form-input" placeholder="Titre de la tâche *" required type="text">
        <select #taskPriority class="form-select">
          <option value="low">Priorité basse</option>
          <option selected value="medium">Priorité moyenne</option>
          <option value="high">Priorité haute</option>
        </select>
      </div>
      <div class="form-row">
        <input #taskDesc class="form-input full-width" placeholder="Description (optionnel)" type="text">
        <button class="btn-add" type="submit"><i class="bi bi-plus-lg"></i> Ajouter</button>
      </div>
    </form>
  </section>

  <div class="tasks-container">
    <!-- Tâches en cours -->
    <section class="tasks-column pending-column">
      <h2><i class="bi bi-hourglass-split"></i> En cours ({{ pendingCount$ | async }})</h2>
      <div class="tasks-list">
        @for (task of pendingTasks$ | async; track task.id) {
          <div [class.priority-high]="task.priority === 'high'" [class.priority-low]="task.priority === 'low'"
               [class.priority-medium]="task.priority === 'medium'" class="task-card">
            <div class="task-main">
              <input (change)="toggleTask(task.id)" [checked]="task.completed" class="task-checkbox" type="checkbox">
              <div class="task-content">
                <h3>{{ task.title }}</h3>
                <p>{{ task.description }}</p>
              </div>
              <span [class]="task.priority" class="priority-badge">{{ task.priority }}</span>
            </div>
            <div class="task-actions">
              <span class="task-date"><i
                class="bi bi-calendar3"></i> {{ task.createdAt | date:'dd/MM/yyyy HH:mm' }}</span>
              <div class="action-buttons">
                <button (click)="highlightTask(task)" class="btn-highlight" title="Mettre en avant"><i
                  class="bi bi-star"></i></button>
                <button (click)="editTask(task)" class="btn-edit" title="Éditer"><i class="bi bi-pencil"></i></button>
                <button (click)="deleteTask(task.id)" class="btn-delete" title="Supprimer"><i class="bi bi-trash"></i>
                </button>
              </div>
            </div>
          </div>
        } @empty {
          <div class="empty-state">
            <span class="empty-icon"><i class="bi bi-emoji-smile"></i></span>
            <p>Aucune tâche en cours !</p>
          </div>
        }
      </div>
    </section>

    <!-- Taches terminées -->
    <section class="tasks-column completed-column">
      <h2><i class="bi bi-check-circle"></i> Terminées ({{ completedCount$ | async }})</h2>
      <div class="tasks-list">
        @for (task of completedTasks$ | async; track task.id) {
          <div class="task-card completed">
            <div class="task-main">
              <input (change)="toggleTask(task.id)" [checked]="task.completed" class="task-checkbox" type="checkbox">
              <div class="task-content">
                <h3>{{ task.title }}</h3>
                <p>{{ task.description }}</p>
              </div>
            </div>
            <div class="task-actions">
              <span class="task-date"><i
                class="bi bi-calendar3"></i> {{ task.createdAt | date:'dd/MM/yyyy HH:mm' }}</span>
              <div class="action-buttons">
                <button (click)="highlightTask(task)" class="btn-highlight" title="Mettre en avant"><i
                  class="bi bi-star"></i></button>
                <button (click)="editTask(task)" class="btn-edit" title="Éditer"><i class="bi bi-pencil"></i></button>
                <button (click)="deleteTask(task.id)" class="btn-delete" title="Supprimer"><i class="bi bi-trash"></i>
                </button>
              </div>
            </div>
          </div>
        } @empty {
          <div class="empty-state">
            <span class="empty-icon"><i class="bi bi-clipboard-check"></i></span>
            <p>Aucune tâche terminée</p>
          </div>
        }
      </div>
    </section>
  </div>
</div>

